#include <fcntl.h>
#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

/*
 * exploit() - Just print a message, to let the program know it's been
 *             hacked.
 */

__attribute__((destructor))
void exploit() {
   
    const char* msg = "you have been hacked\n";
    
    fwrite(msg, sizeof(char), strlen(msg), stdout);
    
    /* TODO: output the contents of the evil file */
    // const char* s = getenv("EVILFILENAME");
    char c;
   
    char * filename = getenv("EVILFILENAME");
    if(filename == NULL){
           filename = "./evil.txt";
	}
      
    FILE* fp = fopen(filename, "r");
   
    if (fp == NULL){
        fputs("file failed to open\n",stdout);
    }
    
    if (fp) {
     
      while ((c = getc(fp)) != EOF)
        putc(c,stdout);
      fclose(fp);
    }
}
